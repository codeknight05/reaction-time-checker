<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reaction Time â€“ Max Score Wins</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }

        body {
            background-color: red;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: Arial, sans-serif;
            color: white;
            font-size: 2rem;
            user-select: none;
            cursor: pointer;
            text-align: center;
            white-space: pre-line;
        }
    </style>
</head>
<body>

<div id="text">Player 1\nClick anywhere to start</div>

<script>
    const TOTAL_PLAYERS = 3;
    const ATTEMPTS_PER_PLAYER = 5;
    const BASE_SCORE = 1000;

    let currentPlayer = 0;
    let currentAttempt = 0;
    let waiting = false;
    let ready = false;
    let startTime = null;

    const results = Array.from({ length: TOTAL_PLAYERS }, () => []);
    const scores = Array(TOTAL_PLAYERS).fill(0);

    const text = document.getElementById("text");

    function show(msg) {
        text.textContent = msg;
    }

    function nextPlayer() {
        currentPlayer++;
        currentAttempt = 0;

        if (currentPlayer < TOTAL_PLAYERS) {
            show(`Player ${currentPlayer + 1}\nClick anywhere to start`);
        } else {
            showFinalResults();
        }
    }

    function showFinalResults() {
        let output = "FINAL RESULTS\n\n";

        let winner = 0;
        let maxScore = scores[0];

        for (let i = 0; i < TOTAL_PLAYERS; i++) {
            output += `Player ${i + 1}\n`;
            output += `Times: ${results[i].join(", ")} ms\n`;
            output += `Score: ${scores[i]}\n\n`;

            if (scores[i] > maxScore) {
                maxScore = scores[i];
                winner = i;
            }
        }

        output += `ðŸ† WINNER: Player ${winner + 1}\n(Max Score: ${maxScore})`;

        document.body.style.backgroundColor = "black";
        show(output);
    }

    document.body.addEventListener("click", () => {
        if (!waiting && !ready) {
            document.body.style.backgroundColor = "red";
            show(
                `Player ${currentPlayer + 1}\n` +
                `Attempt ${currentAttempt + 1}/${ATTEMPTS_PER_PLAYER}\n` +
                `Wait for green...`
            );

            waiting = true;
            const delay = Math.random() * 3000 + 1000;

            setTimeout(() => {
                document.body.style.backgroundColor = "green";
                show("CLICK!");
                startTime = performance.now();
                ready = true;
                waiting = false;
            }, delay);

        } else if (ready) {
            const reactionTime = Math.round(performance.now() - startTime);
            const score = Math.max(0, BASE_SCORE - reactionTime);

            results[currentPlayer].push(reactionTime);
            scores[currentPlayer] += score;

            ready = false;
            startTime = null;
            currentAttempt++;

            document.body.style.backgroundColor = "red";

            if (currentAttempt < ATTEMPTS_PER_PLAYER) {
                show(
                    `Player ${currentPlayer + 1}\n` +
                    `Reaction: ${reactionTime} ms\n` +
                    `Score: +${score}\n` +
                    `Click for next attempt`
                );
            } else {
                show(
                    `Player ${currentPlayer + 1} finished!\n` +
                    `Total Score: ${scores[currentPlayer]}\n` +
                    `Click to continue`
                );
                setTimeout(nextPlayer, 500);
            }
        }
    });
</script>

</body>
</html>
